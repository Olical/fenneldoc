# Fenneldoc
Tool for automatic documentation generation and validation for Fennel language.


## Usage
Fenneldoc looks for `.fenneldoc` configuration file in current directory, and accepts files for which documentation will be generated.

    fenneldoc [flags] [files]


## Design
Fenneldoc loads files at runtime, and goes through exported definitions looking for specific Fennel metadata.
It then forms a `doc` directory, in which documentation files are placed following hierarchy of the project.
If module specifies `version` or `_VERSION` keyword, documentation is placed under the directory which corresponds to the version.

**Note!**
Fenneldoc **runs your code**, so if your program has side effects those will be executed.


## Features
- [x] Parse runtime information of the module.
- [x] Configurable item order and sorting.
- [ ] Validate documentation:
  - [ ] Analyze documentation to contain descriptions arguments of the described function,
  - [ ] Run documentation tests, by looking for code inside backticks.
- [x] Parse macro modules.


# Documentation format
Documentation is generated by analyzing function metadata at run time, and inserting it mostly as is into markdown formatted file.
This means that all markdown features are supported in the docstring, such as text attributes, cross-linking, commenting, e.t.c.

For example, here's how you might define information about your `my-module.fnl` file:

``` fennel
(local my-module {:_VERSION "0.1.0"
                  :_DESCRIPTION "Tag line or short description"
                  :_COPYRIGHT "Copyright info that appears at the end of the document"
                  :_LICENSE "[license](Link to ryour license)"})

(fn my-module.foo [args] "foo's docstring")
(fn my-module.bar [args] "bar's docstring, also see [`foo`](#foo)")

my-module
```

Running `fenneldoc my-module.fnl` will procure `doc/my-module.md` with the following contents:

`````` markdown
# My-module.fnl (0.1.0)
Tag line or short description

**Table of contents**
- [`foo`](#foo)
- [`bar`](#bar)

## `foo`
Function signature

```
(function-name args)
```

`foo`'s docstring

## `bar`
Function signature

```
(function-name args)
```

`bar`'s docstring, also see [`foo`](#foo)

---

Copyright info that appears at the end of the document

License: [license](Link to ryour license)

<!-- Generated with Fenneldoc fenneldoc-version
     https://gitlab.com/andreyorst/fenneldoc -->
``````

### Documenting macro modules
Fennel features macros, which can live in separate files, that is later loaded with `import-marcos` or `require-macros`.
Such files can't have arbitrary data in exported table, such as strings, so instead you should provide functions, that return module descriptions.

Luckily for us, Fennel supports amazing `hash-fn` syntax, which can be used like this `#"some string"`.
This creates anonymous function, that will return `"some string"` when called.
So macro module table should look like this:

``` fennel
(local macro-module {:_VERSION #"0.1.0"
                     :_DESCRIPTION #"Tag line or short description"
                     :_COPYRIGHT #"Copyright info that appears at the end of the document"
                     :_LICENSE #"[license](Link to ryour license)"})
```

Fenneldoc understands that if it got `function` from [special keys](#special-keys), it will call it to obtain value.

### Specifying order of documentation items
Since items in Lua tables have arbitrary order, it is impossible to reason about documentation order by inspecting tables returned from modules at runtime.
As an escape hatch, Fenneldoc supports specifying order of items in a sequential table in special key `:_DOC_ORDER` stored in the module table.
For example we have a module with two functions:

``` fennel
(fn first-function [...]
  "Do something with args."
  ...)

(fn another-function [...]
  "Do something else with args."
  ...)

{: first-function
 : another-function}
```

Because order of the items in exported table is arbitrary, Fenneldoc sorts the table alphabetically by default.
Thus the order of the documentation will be `another-function` followed by `first-function`.
You can override this behavior by adding `_DOC_ORDER` key into the map:

``` fennel
{: first-function
 : another-function
 :_DOC_ORDER [:first-function :another-function]}
```

Now the order will be preserved, and `first-function` will come first in generated documentation.
Note, that you don't need to specify all the keys of your module if you don't care about some specific functions of you module - any missing keys will be sorted alphabetically.

``` fennel
{: first-function
 : another-function
 : some
 : extra
 : stuff
 :_DOC_ORDER [:first-function :another-function]}
```

The order of items in the case above will be `first-function`, `another-function`, `extra`, `some`, `stuff`.

If you wish to sort items differently from alphabetic order, you can specify either `reverse-alphabetic`, or sorting function.
You can set this as a value for the `:order` key in configuration file, or by passing it via `--order VALUE` flag.
Note, that you can't pass function via command-line argument.

## Configuration
Fenneldoc can be configured by placing `.fenneldoc` file at the root of your project, where `fenneldoc` will be called.
Another way is to pass command lines to `fenneldoc` directly. Full set of command line arguments can be found by calling `fenneldoc --help`.

Configuration file is simply a `.fnl` file without extension, which exports a table with keys.
Example of configuration file:

``` fennel
{:keys {:version :VERSION}
 :toc false
 :out-dir "./documentation"
 :silent true}
```

Here, we configure Fenneldoc to look for module version via `:VERSION` key, as opposed to default `:_VERSION`.
There are other keys that can be set up on per project basis, see [special keys](#special-keys) section.

Next we say that we do not need table of contents, by specifying `:toc false`, change output directory to `./documentation`, and suppress all messages and error reports.
Full set of available options can be seen by calling `fenneldoc --help`.


### Special keys
If you do not like `_VERSION` or any other key, you can specify your own keys in `.fenneldoc` or via command-line flags.
At this momment these keys are supported:

- `:version`, can be set via `--version-key KEY`
- `:description`, can be set via `--description-key KEY`
- `:license`, can be set via `--license-key KEY`
- `:copyright`, can be set via `--copyright-key KEY`


## Contributing
Please do.
You can report issues or feature request at [project's Gitlab repository](https://gitlab.com/andreyorst/fenneldoc).
Consider reading [contribution guidelines](https://gitlab.com/andreyorst/fenneldoc/-/blob/master/CONTRIBUTING.md) beforehand.

<!--  LocalWords:  backticks docstring Fenneldoc TODO
 -->
